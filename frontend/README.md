# Locofinder Frontend

Next.js 14 (App Router) frontend for the Locofinder location-intelligence monorepo.

## Stack

| Tool | Purpose |
|------|---------|
| **Next.js 14** (App Router) | Framework |
| **TypeScript** | Type safety |
| **TailwindCSS** | Styling |
| **TanStack Query v5** | Server state & data fetching |
| **Zustand** | Client state (weights, filters) |
| **Zod** | Runtime API response validation |
| **react-leaflet + Leaflet** | Map view (OpenStreetMap tiles) |
| **Sonner** | Toast notifications |

## Pages

| Route | Description |
|-------|-------------|
| `/` | Recommend workflow: set weights/filters → ranked results (list, table, map) |
| `/explore` | Paginated dataset browser |
| `/location/[id]` | Location detail + score explainability |
| `/status` | Backend & Redis health check |
| `/admin` | Reset dummy data (dev-only) |

---

## Local Development

### Prerequisites

- Node.js 20+
- Backend running on `http://localhost:8000`
  - Start it with `docker compose up backend redis` from the repo root, **or** run `uvicorn app.main:app --reload` from `backend/` directly.

### 1. Install dependencies

```bash
cd frontend
npm install
```

### 2. Configure environment

```bash
cp .env.example .env.local
# Default value is already correct for local dev:
# NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
```

### 3. Generate dummy data (first run)

The backend needs data to serve. You have two options:

**Option A — via the Admin UI** (backend must be running):
1. Start the backend: `docker compose up backend redis`
2. Open http://localhost:3000/admin
3. Click **Reset with 10000 rows**

**Option B — via the backend script** (Python 3.11+ required):
```bash
cd backend
pip install -r requirements.txt
python scripts/generate_dummy_data.py          # generates 10 000 rows
python scripts/generate_dummy_data.py --rows 5000  # custom row count
```

This writes `backend/data/dummy_locations.parquet`, which the backend reads on startup.

### 4. Run dev server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000).

---

## Docker Compose (full stack)

From the **repo root**:

```bash
docker compose up --build
```

Services started:
| Service | Host URL |
|---------|----------|
| **Frontend** | http://localhost:3000 |
| **Backend API** | http://localhost:8000 |
| **Redis** | localhost:6379 |

> **Note on API URL in Docker:**
> Inside Docker, the frontend container calls the backend via `http://backend:8000`
> (the Docker service name). This is baked in at build time via the `NEXT_PUBLIC_API_BASE_URL`
> build arg. For local `npm run dev`, the default `.env.local` value `http://localhost:8000`
> is used instead.

> **Dummy data in Docker:**
> `backend/data/` is bind-mounted into the backend container, so the parquet file
> generated by the script (or via `/admin`) persists across container restarts and rebuilds.

---

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `NEXT_PUBLIC_API_BASE_URL` | `http://localhost:8000` | Backend API base URL (baked at build time) |

---

## Quality Gates

All three must pass before merging:

```bash
npm run build      # Next.js production build
npm run lint       # ESLint (next/core-web-vitals + prettier)
npm run typecheck  # TypeScript strict check (tsc --noEmit)
```

Format code:
```bash
npm run format     # Prettier
```

---

## Project Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── layout.tsx          # Root layout (Navbar, Providers)
│   ├── page.tsx            # / — Recommend workflow
│   ├── explore/page.tsx    # /explore — Dataset browser
│   ├── location/[id]/      # /location/[id] — Detail + score breakdown
│   ├── status/page.tsx     # /status — Health check
│   └── admin/page.tsx      # /admin — Dev tools (reset dummy data)
├── components/
│   ├── ui/                 # Primitive components (Button, Badge, Skeleton, Input)
│   ├── FiltersPanel.tsx    # Weight sliders + filter inputs
│   ├── ResultsView.tsx     # Tab switcher: List | Table | Map
│   ├── LocationCard.tsx    # Card in list view
│   ├── RankingTable.tsx    # Table view of ranked results
│   ├── MapView.tsx         # Leaflet map (ssr:false, OpenStreetMap tiles)
│   ├── ScoreBreakdown.tsx  # Feature-level score explainability bars
│   ├── LocationDrawer.tsx  # Slide-in drawer with detail + breakdown
│   ├── Navbar.tsx          # Top navigation bar
│   └── WeightSlider.tsx    # Individual weight slider
├── hooks/                  # TanStack Query hooks (useRecommend, useLocations, …)
├── lib/
│   ├── api.ts              # Centralized API client (all 6 endpoints)
│   ├── schemas.ts          # Zod schemas for all request/response types
│   └── utils.ts            # cn(), formatCurrency(), US_STATES, …
└── store/
    └── filtersStore.ts     # Zustand store (weights, filters, limit, bypassCache)
```
